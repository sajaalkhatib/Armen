@{
    ViewData["Title"] = "تفاصيل المهام المالية";
    Layout = "~/Views/Shared/_AccountingLayout.cshtml";
}

@section Styles {
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="~/css/Accounting/TasksDetalse.css" asp-append-version="true">
}

<!-- Top Navigation -->
<nav class="bg-white shadow-sm p-4 mb-8" data-aos="fade-down">
    <div class="flex justify-between items-center">
        <div class="flex items-center">
            <a asp-controller="Accounting" asp-action="Dashboard" class="action-btn btn-back ml-4">
                <i class="fas fa-arrow-right"></i>
                العودة للوحة التحكم
            </a>
            <h1 class="text-2xl font-bold text-primary-color flex items-center">
                <i class="fas fa-file-invoice-dollar text-yellow-500 ml-3"></i>
                تفاصيل المهمة المالية
            </h1>
        </div>
        <div class="flex items-center space-x-4">
            <div class="relative">
                <button class="p-2 text-gray-600 hover:text-gold-color transition-colors">
                    <i class="fas fa-bell text-xl"></i>
                    <span class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">2</span>
                </button>
            </div>
            <div class="flex items-center space-x-2">
                <img class="w-10 h-10 rounded-full border-2 border-yellow-400" src="https://i.pravatar.cc/100?img=8" alt="صورة المحاسب">
                <div>
                    <span class="font-semibold text-primary-color block">سارة محمود</span>
                    <span class="text-xs text-gray-500">محاسبة رئيسية</span>
                </div>
            </div>
        </div>
    </div>
</nav>

<div class="p-6">
    <!-- Task Header -->
    <div class="task-details-container" data-aos="fade-up">
        <div class="task-header">
            <div class="relative z-10">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 class="text-3xl font-bold mb-2">طلب رقم #ORD-2025-001</h2>
                        <p class="text-lg opacity-90 mb-4">شركة النخبة التجارية</p>
                        <div class="flex items-center space-x-4">
                           
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>

    <!-- Success Alert -->
    <div class="success-alert" id="successAlert">
        <i class="fas fa-check-circle text-xl"></i>
        <span id="alertMessage">تم حفظ البيانات بنجاح!</span>
    </div>

    <!-- Order Information -->
    <div class="p-6">
        <h3 class="text-xl font-bold text-primary-color mb-4 flex items-center">
            <i class="fas fa-info-circle text-yellow-500 ml-2"></i>
            معلومات الطلب
        </h3>

        <div class="order-info-grid">
            <div class="info-card">
                <h4>
                    <i class="fas fa-user text-blue-500"></i>
                    معلومات العميل
                </h4>
                <p>الاسم: <span class="value">شركة النخبة التجارية</span></p>
                <p>الهاتف: <span class="value">+962 79 123 4567</span></p>
                <p>البريد: <span class="value">ahmed@elite-trade.com</span></p>
            </div>

            <div class="info-card">
                <h4>
                    <i class="fas fa-box text-green-500"></i>
                    تفاصيل البضاعة
                </h4>
                <p>نوع البضاعة: <span class="value">إلكترونيات</span></p>
                <p>الكمية: <span class="value">150 قطعة</span></p>
                <p>الوزن: <span class="value">850 كجم</span></p>
            </div>

            <div class="info-card">
                <h4>
                    <i class="fas fa-ship text-purple-500"></i>
                    معلومات الشحن
                </h4>
                <p>ميناء المنشأ: <span class="value">شنغهاي، الصين</span></p>
                <p>ميناء الوصول: <span class="value">ميناء العقبة</span></p>
                <p>تاريخ الوصول: <span class="value">2025-07-18</span></p>
                <p>رقم الحاوية: <span class="value">MSKU123456</span></p>
            </div>
        </div>
    </div>

    <!-- Files Section -->
    <div class="task-details-container" data-aos="fade-up" data-aos-delay="200">
        <div class="p-6">
            <h3 class="text-xl font-bold text-primary-color mb-4 flex items-center">
                <i class="fas fa-folder-open text-yellow-500 ml-2"></i>
                الملفات والمستندات
            </h3>

            <div class="files-section">
                <h4 class="font-semibold text-gray-700 mb-3">الملفات المتوفرة للتحميل:</h4>

                <div class="file-item">
                    <div class="flex items-center">
                        <div class="file-icon file-pdf">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="mr-3">
                            <p class="font-semibold text-gray-800">الملف الأصلي من الاستيراد</p>
                            <p class="text-sm text-gray-500">2.3 MB • تم الرفع في 2025-07-19</p>
                        </div>
                    </div>
                    <button class="action-btn btn-upload text-sm" onclick="downloadFile('import-doc')">
                        <i class="fas fa-download"></i>
                        تحميل
                    </button>
                </div>

                <div class="file-item">
                    <div class="flex items-center">
                        <div class="file-icon file-excel">
                            <i class="fas fa-file-excel"></i>
                        </div>
                        <div class="mr-3">
                            <p class="font-semibold text-gray-800">تقرير الشحن والرسوم</p>
                            <p class="text-sm text-gray-500">1.8 MB • تم الرفع في 2025-07-20</p>
                        </div>
                    </div>
                    <button class="action-btn btn-upload text-sm" onclick="downloadFile('shipping-report')">
                        <i class="fas fa-download"></i>
                        تحميل
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Financial Actions Section -->
    <div class="task-details-container" data-aos="fade-up" data-aos-delay="400">
        <div class="p-6">
            <h3 class="text-xl font-bold text-primary-color mb-4 flex items-center">
                <i class="fas fa-calculator text-yellow-500 ml-2"></i>
                الإجراءات المحاسبية
            </h3>

            <!-- Upload Financial Report Section -->
            <div class="mb-8">
                <h4 class="font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-cloud-upload-alt text-blue-500 ml-2"></i>
                    رفع الملف المالي النهائي
                </h4>

                <div class="drop-area" id="dropArea" onclick="document.getElementById('financialFile').click()">
                    <div class="mb-4">
                        <i class="fas fa-cloud-upload-alt text-4xl text-gold-color mb-3"></i>
                        <p class="text-lg font-semibold text-gray-800">اسحب الملف هنا أو اضغط للاختيار</p>
                        <p class="text-sm text-gray-600 mt-2">يُقبل: PDF, Excel, Word (حد أقصى 10 MB)</p>
                    </div>
                    <input type="file" id="financialFile" accept=".pdf,.xlsx,.docx" style="display: none;" onchange="handleFileUpload(this)">

                    <!-- File Preview -->
                    <div id="filePreview" class="hidden mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="fas fa-file text-green-500 text-2xl ml-3"></i>
                                <div>
                                    <p class="font-semibold text-green-800" id="fileName"></p>
                                    <p class="text-sm text-green-600" id="fileSize"></p>
                                </div>
                            </div>
                            <button class="text-red-500 hover:text-red-700" onclick="removeFile()">
                                <i class="fas fa-times text-lg"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Financial Input Form -->
            <div class="financial-form">
                <h4 class="font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-edit text-green-500 ml-2"></i>
                    إدخال البيانات المالية للإحصائيات
                </h4>

                <div class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                    <p class="text-sm text-blue-700 flex items-center">
                        <i class="fas fa-info-circle ml-2"></i>
                        هذه البيانات لأغراض الإحصائيات الداخلية فقط
                    </p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-money-bill-wave text-blue-500 ml-1"></i>
                            التكلفة الإجمالية ($) *
                        </label>
                        <input type="number"
                               id="totalCost"
                               class="form-input currency-input"
                               placeholder="0.00"
                               step="0.01"
                               min="0"
                               oninput="updateStatistics()">
                        <p class="text-xs text-gray-500 mt-1">إجمالي ما تم دفعه للطلب</p>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-chart-line text-green-500 ml-1"></i>
                            مبلغ الأرباح ($) *
                        </label>
                        <input type="number"
                               id="profitAmount"
                               class="form-input currency-input"
                               placeholder="0.00"
                               step="0.01"
                               min="0"
                               oninput="updateStatistics()">
                        <p class="text-xs text-gray-500 mt-1">صافي الربح المحقق من الطلب</p>
                    </div>
                </div>

                <!-- Additional Notes -->
                <div class="form-group mt-6">
                    <label class="form-label">
                        <i class="fas fa-sticky-note text-yellow-500 ml-1"></i>
                        ملاحظات إضافية (اختيارية)
                    </label>
                    <textarea id="financialNotes"
                              class="form-input"
                              rows="3"
                              placeholder="أي ملاحظات مالية إضافية حول هذا الطلب..."></textarea>
                </div>

                <!-- Action Buttons -->
                <div class="flex space-x-4 mt-8">
                    <button class="action-btn btn-close-order flex-1" onclick="closeOrderFinancially()" id="closeOrderBtn" disabled>
                        <i class="fas fa-check-circle"></i>
                        إغلاق الطلب ماليًا
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<div class="modal-overlay" id="confirmModal">
    <div class="modal-content">
        <div class="text-center">
            <div class="text-6xl text-green-500 mb-4">
                <i class="fas fa-check-circle"></i>
            </div>
            <h3 class="text-2xl font-bold text-primary-color mb-4">تأكيد إغلاق الطلب ماليًا</h3>
            <div class="text-right bg-gray-50 p-4 rounded-lg mb-6">
                <p class="mb-2"><strong>رقم الطلب:</strong> <span id="confirmOrderId">#ORD-2025-001</span></p>
                <p class="mb-2"><strong>العميل:</strong> <span id="confirmCustomer">شركة النخبة التجارية</span></p>
                <p class="mb-2"><strong>التكلفة الإجمالية:</strong> <span id="confirmTotalCost">$ 0.00</span></p>
                <p class="mb-2"><strong>مبلغ الأرباح:</strong> <span id="confirmProfitAmount">$ 0.00</span></p>
            </div>
            <p class="text-gray-600 mb-6">بعد التأكيد، سيتم إغلاق الطلب ماليًا وحفظ البيانات في سجلات الإحصائيات. لا يمكن التراجع عن هذا الإجراء.</p>
            <div class="flex space-x-4">
                <button class="action-btn btn-close-order flex-1" onclick="confirmCloseOrder()">
                    <i class="fas fa-check"></i>
                    تأكيد الإغلاق
                </button>
                <button class="action-btn btn-back flex-1" onclick="closeModal()">
                    إلغاء
                </button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="~/js/Accounting/TasksDetalse.js" asp-append-version="true"></script>
}
